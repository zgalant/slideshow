<!DOCTYPE html>
<html>
<head>
  <title>Facebook Slideshow</title>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
  <script src="https://raw.github.com/srobbin/jquery-backstretch/master/jquery.backstretch.min.js"></script>
    <style>
        body.connected #login { display: none; }
        body.connected #logout { display: block; }
        body.not_connected #login { display: block; }
        body.not_connected #logout { display: none; }

        * { padding: 0; margin: 0; }

        html, body { height: 100%; }

        img{
            position:absolute;
            top:0;
            bottom:0;
            left:0;
            right:0;
            margin:auto;

        }
        #login-stuff{
            display:none;
        }
    </style>
    <script>
        window.fbAsyncInit = function() {
            FB.init({
                appId      : '555107791186650', // App ID
                // channelUrl : 'channel.html', // Channel File
                status     : true, // check login status
                cookie     : true, // enable cookies to allow the server to access the session
                xfbml      : true  // parse XFBML
            });

            FB.Event.subscribe('auth.statusChange', handleStatusChange);
        };

        function handleStatusChange(response) {
            document.body.className = response.authResponse ? 'connected' : 'not_connected';
            if (response.authResponse) {
                console.log(response);
                updateUserInfo(response);
                getUserPhotos();
            }
        }

        function updateUserInfo(response) {
            FB.api('/me', function(response) {
                //document.getElementById('user-info').innerHTML = '<img src="https://graph.facebook.com/' + response.id + '/picture">' + response.name;
            });
        }

        function loginUser() {    
            FB.login(function(response) {
                getUserPhotos();
            }, {scope:'user_photos,friends_photos'});     
        }

        Array.prototype.shuffle = function () {
            for (var i = this.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var tmp = this[i];
                this[i] = this[j];
                this[j] = tmp;
            }
            return this;
        }

        function getUserPhotos() {
            FB.api('/me/photos?fields=source', function(response) {
                console.log('Got friends: ', response);

                if (!response.error) {
                    var markup = '';

                    var photos = response.data;

                    function randomNumber(low, high){
                        var r = Math.random();
                        var rand = low + Math.floor(r * (high - low + 1));
                        return rand;
                    }

                    function changePhoto(photos){
                        var photo = photos[randomNumber(0, photos.length-1)];
                        var markup = '<img src="' + photo.source + '"> ';
                        document.getElementById('photo').innerHTML = markup;
                        setTimeout(function(){
                            changePhoto(photos);
                        }, 2000);
                    }
                    // changePhoto(photos);
                    $.backstretch(photos.shuffle(), {duration: 2000, fade: 500});
                }
            });
        }

        // Load the SDK Asynchronously
        (function(d){
            var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement('script'); js.id = id; js.async = true;
            js.src = "http://connect.facebook.net/en_US/all.js";
            ref.parentNode.insertBefore(js, ref);
        }(document));

    </script>
  <meta name="viewport" 
        content="initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
</head>
<body>

    <div id="login-stuff">
    	<div id="fb-root"></div>
        <div id="login">
            <p><button onClick="loginUser();">Login</button></p>
        </div>
        <div id="logout">
            <p><button  onClick="FB.logout();">Logout</button></p>
        </div>
        <a href="#" onclick="getUserPhotos();">Get photos</a><br>
    </div>

    
    <!-- <div id="photo"><img src="https://sphotos-b.xx.fbcdn.net/hphotos-snc6/s720x720/8162_10200190382976324_1986183353_n.jpg"></div> -->

</body>
</html>