<!DOCTYPE html>
<html>
<head>
  <title>Facebook Slideshow</title>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
  <script src="https://raw.github.com/srobbin/jquery-backstretch/master/jquery.backstretch.min.js"></script>
    <style>
        body.connected #login { display: none; }
        body.connected #logout { display: block; }
        body.not_connected #login { display: block; }
        body.not_connected #logout { display: none; }

        #login, #logout{
            float:right;
            margin-right:10px;
        }

        * { padding: 0; margin: 0; }

        html, body { height: 100%; }
        img { display: block; }

        #full {
            height: 100%;
            overflow: hidden;
        }
    </style>
    <script>
        window.fbAsyncInit = function() {
            FB.init({
                appId      : '555107791186650', // App ID
                // channelUrl : 'channel.html', // Channel File
                status     : true, // check login status
                cookie     : true, // enable cookies to allow the server to access the session
                xfbml      : true  // parse XFBML
            });

            FB.Event.subscribe('auth.statusChange', handleStatusChange);
        };

        function handleStatusChange(response) {
            document.body.className = response.authResponse ? 'connected' : 'not_connected';
            if (response.authResponse) {
                console.log(response);
                updateUserInfo(response);
                getUserPhotos();
            }
        }

        function updateUserInfo(response) {
            FB.api('/me', function(response) {
                //document.getElementById('user-info').innerHTML = '<img src="https://graph.facebook.com/' + response.id + '/picture">' + response.name;
            });
        }

        function loginUser() {    
            FB.login(function(response) {
                getUserPhotos();
            }, {scope:'user_photos,friends_photos'});     
        }

        Array.prototype.shuffle = function() {
            for(var i = this.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var tmp = this[i];
                this[i] = this[j];
                this[j] = tmp;
            }
            return this;
        }

        function getUserPhotos() {
            FB.api('/me/photos?fields=source&limit=100', function(response) {
                console.log('Photos: ', response);

                if (!response.error) {
                    var markup = '';

                    var photos = response.data;

                    var urls = [];
                    for(var i = 0; i < photos.length; i++){
                        var photo = photos[i];
                        urls.push(photo.source);
                    }

                    function changePhoto(photos){
                        console.log(photos);
                        var r = Math.random();
                        var low = 0;
                        var high = photos.length - 1;
                        var rand = low + Math.floor(r * (high - low + 1));
                        var photo = photos[rand];
                        var markup = '<img src="' + photo.source + '"> ';
                        $('#full').html(markup);
                        resizeImage();
                        setTimeout(function(){
                            changePhoto(photos);
                        }, 2000);
                    }
                    changePhoto(photos);

                    // $.backstretch(urls.shuffle(), {duration: 7000, fade: 800});
                }
            });
        }

        function resizeImage() {
            var win = $(window),
                fullscreen = $('#full'),
                image = fullscreen.find('img'),
                imageWidth = image.width(),
                imageHeight = image.height(),
                imageRatio = imageWidth / imageHeight;
            
            console.log("resize");
            var winWidth = win.width(),
            winHeight = win.height(),
            winRatio = winWidth / winHeight;

            if(winRatio > imageRatio) {
            image.css({
                width: winWidth,
                height: Math.round(winWidth / imageRatio)
            });
            } else {
                image.css({
                width: Math.round(winHeight * imageRatio),
                height: winHeight
            });
            }
        }

        // var photos = [
        //     {source: "https://sphotos-b.xx.fbcdn.net/hphotos-ash4/s720x720/283746_3495507276888_376276361_n.jpg"},
        //     {source: "https://sphotos-a.xx.fbcdn.net/hphotos-ash4/s720x720/196904_4195671660560_2102131821_n.jpg"},
        //     {source: "https://sphotos-a.xx.fbcdn.net/hphotos-ash4/s720x720/481732_4049365723003_1833381535_n.jpg"}
        // ]

        // function changePhoto(photos){
        //     console.log(photos);
        //     var r = Math.random();
        //     var low = 0;
        //     var high = photos.length - 1;
        //     var rand = low + Math.floor(r * (high - low + 1));
        //     var photo = photos[rand];
        //     console.log(rand);
        //     console.log(photo);
        //     var markup = '<img src="' + photo.source + '"> ';
        //     $('#full').html(markup);
        //     resizeImage();
        //     setTimeout(function(){
        //         changePhoto(photos);
        //     }, 2000);
        // }
        // changePhoto(photos);

        // Load the SDK Asynchronously
        (function(d){
            var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement('script'); js.id = id; js.async = true;
            js.src = "http://connect.facebook.net/en_US/all.js";
            ref.parentNode.insertBefore(js, ref);
        }(document));

    </script>
  <meta name="viewport" 
        content="initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
</head>
<body>
	<div id="fb-root"></div>
    <div id="login">
        <p><button onClick="loginUser();">Login</button></p>
    </div>
    <div id="logout">
        <p><button  onClick="FB.logout();">Logout</button></p>
    </div>

    <div id="full">
        <img src="https://sphotos-b.xx.fbcdn.net/hphotos-ash4/s720x720/283746_3495507276888_376276361_n.jpg" />
    </div>
</body>
</html>